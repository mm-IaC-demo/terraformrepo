I den video her skal vi nå gå videre med det vi har bygd på allerede tidligere i det her faget. Vi skal nå ta neste steg etter at vi har sett på hvordan vi kan dele opp infrastrukturen våres eller dele opp innholdet i terform konfigurasjonen våres inn i moduler. Sånn at vi kan ta en kjapp liten recap på det vi hadde vært gjennom fra før. Det er jo det at vi har opprettet en mappestruktur i VScode hvor vi da har en typisk en konfigurasjon i en main variables og en tfvarsfil som inneholder inneholder det variablene vi har

deklarert der. Så har vi modulene som representerer de ressursene vi skal deploye. Sånn at eh det vi skal gjøre nå da, det er at vi skal se på hvordan vi kan gjøre det her videre med at vi kan ha flere type miljø som blir da deployet ut ifra en og samme kod repo da. Og det er typisk en sånn en multienvironment stack. Vi skal bare bruke en konfigurasjon, men vi skal ha flere environment som kan benytte seg av den her konfigurasjonen og deploye unike miljø da som representerer typisk dev, test og produksjon i den her

sammenhengen. Så vi kan jo først se litt på det at vi skal nå ta å få mye mer mapper, mye mer filer å forholde oss til. Så det kan virke litt sånn ja mye i starten å ta innover seg. Men det vi skal typisk gjøre da, det er at vi skal ha moduler fortsatt som representerer de ressursene som vi skal deploye. Og i det her eksempel så er jo det da network og compute VM. I tillegg så skal vi da ha stacks som er der vi skal bygge opp infrastrukturen våres. Det er der vi skal da bygge og sette sammen, definere

eh oppsettet og så konfigurer hele infrastrukturen våres. Sette opp så være der der vi arketerer det. sånn at i teksten så kan vi da kalle opp alle de her modulene sånn at vi kan se nå at når vi har i Stex main tpsenen for eksempel så kaller vi opp da det som har med eh nettverkmodulen å gjøre eller og da ikke minst compute modulen å gjøre da som er i det her tilfellet VM så teksten så kaller vi opp de her modulene ser bortifra altså det er litt dårlig praksis med at vi har resource groupen i en nettverksmodul her sånn at i

kodeeksempelet som ligger ut påubben så har jeg fjernet det her resourcegroupen at den ligger i nettverksmodulen for vi vil jo at eh resourcegruppen skal være tilhørende typisk environments da der det er dem som er den rette eieren av den ressursen sånn at når vi da har definert sten altså eller stacks konfigurasjon med de ressursene vi ønsker å ha der så går vi videre og ser på da det som har med environments og environments konfigurasjonsfilene våres der kaller vi da opp stacks eh konfigurasjonen våres. Sånn at uansett

nå da når jeg eventuelt står i dev test eller prodmappa i terminalen fordi i de her mappene hvis kjører terraform init terraform apply nei terraform plan, terraform apply og hekte på typisk da sånn TFvarsfil som er med unikt innhold til de her deploymentsene våres. For det kan jo være at eller vi ønsker mest sannsynligvis å ha en god navnestandard på det ressursene som rulles ut i selv. Sånn at for eksempel når man har et devmiljø så hekter man på et navn som inneholder for eksempel dev sånn at man

ser enkelt at her er development miljøet. I tillegg så er det kanskje ønskelig å ha annen type stockkeeping unit, altså hv hvordan versjon det er av den virtuelle maskinen man får for det. Altså produksjon krever kanskje mer CPU og minne for mer belastning. koster kanskje mer og i måneden. Mens for dev så trenger man ikke å ha de her samme type kostnadene. Så da kan vi skalere ned typisk størrelsen på ressursene som er i dev og tester. Sånn at det er i de her environments mappene vi faktisk kjører de her kommandoene. Og

det er her vi kaller opp eh steken. Og steken igjen kaller opp da modulene som er med og er da de her ressursene som infrastrukturen våres er bygd opp av. Så det er kanskje litt masse å ta innover seg nå i liksom i første omgang. Men det her er det som vi da skal se på eh videre da i den eh videoen nå hvor vi da tar for oss å se på selve kodeoppsettet da. Så hvis vi da tar og går til IVS coden nå, så har jeg i samme repoet som jeg bruker i alle andre eh videoer og da er tilgjengelig linken i fagsiden. Så

har jeg nå opprettet under modul 4 en ny mappe som heter terraform st og da en demo vid sticks som er en mappe som ligger under der hvor man da kan finne det her eksempelet som jeg skal gå gjennom. Det er jo sånn som vi sa steken. Her har vi en egen main til som er den som henter opp compute. Det er den som henter opp network. Det er der vi kaller opp de modulene som er ressursene som skal begynte å under modules der ligger jo da compute og network som er da de som representerer ressursene. Her ser vi at under compute

VM nå så har vi at vi har en public IP som VMen trenger. Vi har et network interface som VMen trenger. Vi har en IPfig som VMen trenger. Vi har og tags. Vi har og vi har ikke minst her selve VMen som da får navn fra variabler og hvor den skal ligge hen fra variabler og ikke minst size eh admin user ogør og SSO public key for at vi skal kunne logge oss på den her maskinen etterpå. Sånn at her er hele VM oppsettet og så har vi og da variabeloppsettet for den heren i en egen variables T file innenfor modulene. Det her er jo kjent

fra forrige leksjon. Vi har en egen main variables og output som er med da å sende informasjon mellom modulene. Sånn at modulene er vi kjent med. Sten er da der vi kaller opp modulene der som vi kanskje hadt prosjektet våres før hvor vi da bygd opp kalte opp modulene og gjorde alt sammen. Men siden vi ønsker nå at vi skal da gå over til å ha flere eh environments fordi at for noe så hadde vi jo bare en config, en state file. Og hvis vi deployet forskjellige innhold til de her ressursene så ville

de jo slette å operate nye hvis hvis for eksempel endret navn eller endret sku et cetera. Så i mainstekene så har vi eh i mainsteken kaller vi opp modulene. Og her har vi og variables som representerer alt det da som den trenger for å sette opp da typisk det som har med eh alt av input som kommer i mainfilen. For her er det masse variabler og det må da være dekklarert i variables eh til stacksen. Så men nå går vi over til det som har med environments å gjøre, for der er det jo der vi skal faktisk kjøre det eh de her terraform

kommandoen. Så nå ser vi jo nederst her at det står i environment dev. Så da kan jeg nå for eksempel bare kjapt vise da at dev sin eh main tf den er der vi deklarerer. Skal vi ikke si vi gir eh resourcegruppen et navn. Vi oppretter resourcegroupen og så kaller vi opp steken. Altså steken er der vi bygger sammen hele infrastrukturen våres. Og i environmentet så kaller vi opp sexen. For da vil alt ressursene som teksten er konfigurert og sette opp få de navnene som er definert i eh devmappa da. Jeg

kan jo vise da at vi har så under hvert miljø så har vi en variables file som representerer da alle de variablene som den her dev environmentet trenger da. Eh, det som og er greit eller det som er viktig å tenke på nå, jeg har en fil som er tilgjengelig repet her. Jeg har jo en dev.tfarsfil her, men den vil jo, jeg har git ignore på at tforvarsfilet skal ikke pushetes ut i git fordi at det kan inneholle sensitiv informasjon. Typisk noe jeg bruker av variabel input fra mitt oppsett. Men jeg har laget en rename to

dev.tfar som er da den blir ikke sett på som eller den skal ikke ignoreres av gitt. Og her kan dere da se alt av det som kommer inn av innput til det her oppsettet jeg har. Her er naturlig nok viktig å velge den subskriptidenideen en selv har og selv benytte. Sånn at det her kan avvik fra det som faktisk er den informasjonen dere skal benytte dere av. I tillegg så er det viktig nå å tenke på at det her oppsettet det deployer veldig eller helt identiske miljø. Så hvis alle studentene nå kopierer bare den her det

oppsettet begynner å deploy det som vil fungere når man har en en dot eller d. tfarsfil som gir input. Her må man selvfølgelig legge inn sin egen IP-adresse hvis man skal kunne SSO inn. Eh i tillegg så må man og typisk ha sin egen SSO public key da som man kan finne ut på nettet hvordan man oppretter SS public key hvis man ikke kjenner til det fra før. Ganske enkel fremgangsmåte. Sånn at når man trenger da typisk den her backend, nei ikke backend, men main, vi har variables og vi har input til variablesene, så har vi egentlig det som

er nok for den her dev environment. Og den her mainfillen helt identisk innenfor både prod og test. sånn at main TF helt identisk på alle de her tre miljøene. Eneste forskjellen er at vi har en egen variables innhold som definerer for eksempel annen VM size, annet environment eh navn for de her ressursene, annen tags som blir satt. Sånn at for hver gang da hvis jeg går for eksempel til eh min eh hvis man bruker Windows er det annet eller på annen kommando enn Cell. Men hvis jeg går nå for eksempel da på

prod eh så ser jeg jo her at jeg har en hel del filer. Vanligvis så er det kanskje bare backend, main og den variabl som er der fra før fordi at man har ikke alt eh oppsettet typisk sånn TF state. TF state er jo den filen som representerer staten sånn som den er eh i Aser. Og da sjekker den hele tiden koden opp mot den her filen for å finne ut hva det er som faktisk finnes i Aser. Sånn at når jeg nå går på eh prodmiljøet mitt her og kjører terraform init, så vil en da laste inn det nødvendige pluginsene. Og så kjører jeg

terraform plan. Og så ser vi her at jeg kan bruke da en varfile, men da er ikke dev, for da er prod. Og da vil jeg nå automatisk da sende alt av det innholdet som er i den her Prod tilfarsfilen. Merk at det er viktig å stå i riktig foldere. Da sender jeg den infoen til min deployment da. Så når jeg trykker enter her nå, så starter den her eh deploymenten. Og den vil da begynne å rulle ut en resource group, et nettverk med et subnett og en VM et nett eller med eh offentlig adresse. Hvert fall for dev ikke for prod og

test, for det er vanligvis veldig sjelden jeg ønsker å ha en offentlig adresse der. Og jeg har og da en locate public IP eh som er en sånn switch eller en boligan man kan skrive true der så vil maskinen få en en offentlig adresse. Men by default så er kun det vi som gjør det da. Så nå har jeg jo kjøp kjørt plan. Så hvis jeg nå da tar bare og så apply så vil jeg nå starte deploymenten av denne her. Det som er viktig å tenke på nå alt det her oppsettet funker. Men det som er og viktig å tenke på, det er

jo at jeg har ikke praktisert eh typisk eh det som jeg har introdusert og flagg til dere tidligere. Hvis alle dere studenter nå kopierer hele den her eh mappen som heter demoid stecks, så vil dere alle sammen få navnekonflikt fordi den oppretter som vi skal se i planen her nå at den oppretter alle sammen oppretter et Snett som heter Proemo alle sammen oppretter en resource group som heter for skal vi se hvis vi scroller opp så ser vi her at alle sammen vil få en resource group som blir da hetes RG

Prod eller dev test demo og det vil ikke fungere siden vi jobber i et delt miljø. Sånn at oppgaven litt for den her uka da blir også tilpass kodereoet. Man kan bygge det opp fra bunn hvis man har lyst til det, basert på hva oppgaveteksten etterspør, men det er jo å bygge det opp til å tilpasse det sånn at det er i henhold til god praksis sånn som vi har gjort før, men før med at dere har locals eh generere eller generere egne verdier som gjør at alt sammen får et unikt navn basert på det dere basert på det dere gir inn til den

her deploymenten eh når dere kjører det da. sånn at ja, det fungerer. Dere kan kopiere hele den her mappa demo eh one stack og så får dere environment broadcest modules og stacks. Så funker alt det helt ut av boksen så lenge ingen andre har kjørt det. Så oppgaven blir da, hvordan kan dere basert på det dere har lært i tidligere uka nå, få sat det med locals eh sånn at navn, tags et ceter blir korrekt sånn som vi har lært i tidligere videoer nå. Eh i tillegg så har jeg lagt meg en bæs create her form

files and folders og powshell create files and folders. For den som ønsker da så kan vi gå inn og ta med dere filene her inn på en mappe i eget repo og bare kjør den her POell kommandoen. Nei, Powerellskriptet fordi at da vil den opprette hele den her mappestrukturen med environments, modules og stacks med og de her filene inn under seg og så slipper man å gjøre det hele tiden. Så hvis dere vil begynne, jeg anbefaler alltid å begynne å prøve med et tomt oppsett sånn at man er med å bygge opp det helt selv fra start, så kan man

bruke heller det her demo one som inspirasjon og hjelp til å komme i gang med hvordan vi for eksempel henter opp de her modulene, hvordan vi henter vi opp steksten, hvordan er det med variablene, hvor må alle variablene være og stå lignendes. Men dere må da se på tidligere gjennomgåte moduler hvordan dere gjør det. For eksempel med de her localsene. Hvor bør localsene gjøre ligge i henhold til god praksis? Jo, kanskje noen local bør ligge på environments hvis det har typisk med det som er med resource group name. Andre

logos bør kanskje være innenfor modulene hvis det er noe som skal genereres eh av unike navn der da. Så vi kan jo se for eksempel for network main så har vi da her at den oppretter navn. Men det kan og være at for eksempel hvor får vi tags fra? Jo, det er kanskje noe vi typisk får fra environmentet for det er jo environment det som eier typisk de tagsene som blir satt eh her da. Sånn at det er viktig å tenke på hvor er det vi vil sett noe eh og hvor ofte eller hvor er det man unngår at det er mest

sannsynlig for menneskelig feil. For eksempel er det mye for det er og flere aspekter som er viktig å tenke på med tanke på teorien som er gått gjennom for den her modulen. Det her var ikke så mye sånn lært av terraform. Det er mer se på det som er et eksempel. Hvordan kan jeg tilpasse det til meg selv og hvordan kan jeg fortsette å ta i bruk da de her gode eh praksisene som jeg lært tidligere nå med unike navn og siden vi bruker shared environment så må vi naturlig nok tilpasse det. Så nå ser jeg nå at mine

ressurser er ferdig deployet. Så hvis jeg hopper over til portalen nå så kan jeg nå under resource group. Se her at jeg har fått min resource group pro demo. Her har jeg eh mine ressurser. I tillegg kan jo se at under resource Group Dave demo så har jeg og mine ressurser bare at jeg og har en public IP som er opprettet for TVmiljøet men ikke for prodmiljøet. Det er jo typisk sånn prodmiljø da har vi gjerne kanskje ikke en offentlig adresse på en egen VM som er inn de i våres nettverk. Da har vi gjerne kanskje Nirewall eller annet

som står i front som håndterer alt av eh trafikk fra omver. Så men det her var bare en kjapp gjennomgang nå hvor jeg visste altså ok vi har masse forskjellige filer og folders som representerer både moduler som representerer environments og ikke minst og stekst og så kan vi da deploy her u ifra at vi konfigurerer alt sammen i steksten. Eh og så er environments av det som representerer å kalle opp teksten. Så steksten er det der vi henter alle modulene. Blir kanskje litt mye å ta innover seg nå i starten, men

prøv eh å deploy det. Prøve å se på koden. Prøve å tilpasse den da etter beste evne med og så få de navnene som er for eksempel unik, sånn som vi har gjort i tidligere gjennomganger, sånn at man da skjønner hva det her eh går i nå. For det her er god praksis. Vi får nå et eget environment med en egen statefil. Her er Terraform State. Terraform statef er jo det da den som representerer alle ressursene som befinner seg med alle de unike IDen. Sånn at vi har da en en fil som vi kan se på eller som terrafform

ser på opp mot den her koden våres da. I tillegg så er det jo da nå har vi jo splittet opp da i testv og prodd og da vil vi se at da får vi forskjellige TVstatefiler i forskjellige mappene som er god praksis å separere det fra hverandre. Vi skal etter hvert nå begynne å se på hvor at statefilene må ligge på en et sentralisert sted fordi at flere skal få tilgang til en sånn som det er nå med min PC, min deployment bare en til en forhold. Det går jo ikke an hvis vi har et større prosjekt hvor mange skal jobbe mot en og samme

infrastruktur. Da må vi ha en plass hvor flere brukere har tilgang til statefill. Da må vi ha en mekanisme som gjør at det er mulig og at for eksempel vi unngår konflikt med at flere prøver å deploy eller gjø endringer til infrastrukturen samtidig så har vi typisk en sånn lokmekanisme som finnes inn i de her eh tjenestene som tilbyr lagring av TVstatefilder. Så skal du si liten en 15 minutters gjennomgang av et oppsett som vi kan bruke med forskjellige eh moduler og ved bruk av stacks og forskjellige

environments og noen filer som gjør at vi kan enkelt opprette de her filene og folderene så vi kan komme i gang og teste selv. Så da er det bare å prøve å se på øvinger for den her uka. Og så er det å komme i gang med eh det praktiske jobbingen.

